---
layout: post
title: "Oracle Cloud Object StorageをS3として使う"
date: "2019-12-22 14:09:00 +0900"
categories: 
  - blog
---
## 前提

* 2019/10/10 現在の方法です。
* Object Storage は Free Tier が 20GB あります。

## 参照Qiita

<a href="https://qiita.com/kaohas/items/898efe9e5aa35f2a1402">https://qiita.com/kaohas/items/898efe9e5aa35f2a1402  


ですが、現時点では少々手順が変わっているのでメモ  

## バケットの作成

<img src="/images/2020/09/b3db2ce9f405d742883ee61b2b90e08d.png" alt="b3db2ce9f405d742883ee61b2b90e08d" loading="lazy">  


バケットの作成自体は特におもしろい事はないので省略しますが、参考記事には  

「バケットをルートコンパートメントに作成すること」 と書かれているのでその通りにしました。  

バケット一覧の画面で（ルート）と書かれていれば問題ないでしょう。  


<img src="/images/2020/09/9ff327294d2838cd2c26e770d0a4c0b4.png" alt="9ff327294d2838cd2c26e770d0a4c0b4" loading="lazy">  

## アクセスキーの作成

ここが参照Qiitaと異なっているので、メモしたかった所です。  


<img src="/images/2020/09/c991a3ae36fb27da6e8f6150291aab68.png" alt="c991a3ae36fb27da6e8f6150291aab68" loading="lazy">  


* アイデンティティ→ユーザー　から自分のユーザーを選ぶ。 メールアドレスがIDになっているものを選択しました。
* 左下の`リソース`欄にある `顧客秘密キー` をクリックします。
* 秘密キーを生成　ボタンをクリック
* 名前は何でも良いので自由に付ける。


<img src="/images/2020/09/379b2e3df98a782dbc94c7f0bc45eb4d.png" alt="379b2e3df98a782dbc94c7f0bc45eb4d" loading="lazy">  


真ん中に表示されたキーは、再表示できないのでコピーして保存しておく。  


<img src="/images/2020/09/e17f96a744129730897fbb22672dea7a.png" alt="e17f96a744129730897fbb22672dea7a" loading="lazy">  


アクセス・キー　と書いてある部分の　`コピー` リンクをつかって、アクセスキーのIDをコピーしておく。  

62714b857ab1aef1df653bae5002a6bacd41a25b のような感じの文字列である。  


S3で言うアクセスキーが、アクセスキーのID（上の例では 627... という文字列） で、アクセスシークレットが、生成時に表示された文字列である。  

AWS_ACCESS_KEY_ID=`62714b857ab1aef1df653bae5002a6bacd41a25b` （例）  

AWS_SECRET_ACCESS_KEY=`最後が = で終わる文字列` （例）  

## オブジェクトストレージネームスペースの取得

* コンソールの右上の、ユーザーのアイコンが表示されている部分をクリックし、 `テナンシ： <テナント名>` というリンクをクリック
* 表示された画面の中央に表示されている、 `オブジェクト・ストレージ・ネームスペース` というIDが必要になるのでコピーする。


<img src="/images/2020/09/2298c3a6ffa3b9d7edf093657385fad4.png" alt="2298c3a6ffa3b9d7edf093657385fad4" loading="lazy">  

## S3互換URLの取得

今まで取得した情報を組み合わせて、アクセス用URLを組み立てる  


https://`ネームスペース`.compat.objectstorage.`リージョン`.oraclecloud.com  


* ネームスペースは、上記で取得した`オブジェクト・ストレージ・ネームスペース`
* リージョンは、コンソールのURLを見てください。 console.ap-tokyo-1.oraclecloud.com なら ap-tokyo-1 がリージョンです
* アクセスキー、アクセスシークレットは上記で取得したものを使ってください

## 蛇足
### この内容が判明するまで

検索しまくったり色々として2時間くらいをツブしました。。がっくり。  

Classicな話とか、旧バージョンとかで操作が大分違うようで、大混乱しました。  

### オブジェクトストレージネームスペース

オブジェクトストレージネームスペースは、とりあえず テナント名 を入れて接続して、（繋がるには繋がります）  

適当にフォルダを作る操作などをすると、エラーメッセージの中に入っている･･･が、普通に拾っても面倒ではないので本当に蛇足。  

