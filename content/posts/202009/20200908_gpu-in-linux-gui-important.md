---
layout: post
title: "普段使いのLinux PCのグラボを交換したら快適になった"
date: "2020-09-08 16:47:00 +0900"
categories: 
  - blog
---
## 前提条件

* 4Kモニタ + フルHDモニタのデュアル
* Linux Mint 20
* Core i5 6500 / 24GBメモリ

## tl;dr;

前提条件としてデュアルディスプレイするのであれば、グラボはメモリ4GB積んでるやつを選ぶべき。  

GeForceだと1050とか1650とか。 AMDだとRX460, 560あたり？  

## 変更の経緯

そもそも、Skylakeの内蔵GPUは4K+フルHDのデュアル出力が可能…だが  

どうやっても、不具合が解消できなかった。 フルHD＋フルHDであれば全然問題ないのだが、  

HiDPIを設定するとマウスカーソルがちらついてしまうのがどうしても解消できなかった。  


仕方がないので、できるだけ安い、４K出力なグラボを探した結果、Quadro K620を見つけた。  

中指を立てられてしまうnvidiaだけれども、プロプライエタリドライバはJetson Nanoで割とよく動くというのは  

経験していた。 のと、本当はAMD系がほしかったけれどもお高かった。今ならRXシリーズがマイニング用とかで  

お安くでているのでそれを買うと良いかもしれない。  


話を元に戻すと、Quadroは普通に動いた。 チラツキとも無縁だし、Youtubeも普通に見れる。  

が、雀魂（麻雀はよくわからないけれども、3DのHTML5ゲームとしてベンチマークにつかってる）を動かすと  

もう見事なコマ送り。 なるほどLinuxデスクトップのパフォーマンスってこんなもんか…  

ブラウザがGPUアクセラレーション使えてないっぽいし、そんなもんよね。と愚痴っていたのです。  

（間違ってます。そんなもんじゃないです）  


ある日、ふと、`nvidia-smi`コマンドを打ってみると、VRAMの使用量が割と最大値に近い値になっていた。  

(1800MiB/1900MiB みたいな値）  

これはもしかして、VRAM足りてない…？ と思い、うちで4K出力が可能なまともなグラボのGeForce 1060(6GB)を  

ゲーム用PCからもってきた（HPのケースから交換した甲斐があった。なお、電源も交換している）  


グラボを交換して初起動。nvidiaプロプライエタリドライバを使っているので特に問題なく起動、  

HiDPIの設定をしてブラウザを触っていると、なんか軽い。もうこの時点でちょっと違うかもしれないという感じがする。  

試しに雀魂を起動してみる。もうアニメーションが全然違う。ログイン画面のさくらの花びらがちゃんと動いている。  

今まではこの時点でカクカク、グラフィック処理が間に合わなくてタイムアウトになるくらいだったのが全く問題ない。  

プレイしてみても快適だった。なんてこった。 もう一枚のモニタでYouTube動画を再生しても余裕。 `nvidia-smi`してみると…  

```
`|===============================+======================+======================|
|   0  GeForce GTX 106...  Off  | 00000000:01:00.0  On |                  N/A |
|  0%   51C    P0    29W / 120W |   2988MiB /  6044MiB |     16%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|    0   N/A  N/A       897      G   /usr/lib/xorg/Xorg               1385MiB |
|    0   N/A  N/A      2109      G   cinnamon                          122MiB |
|    0   N/A  N/A      2951      G   ...o/bin/firefox/firefox-bin      625MiB |
|    0   N/A  N/A      3627      G   ...AAAAAAAAA= --shared-files       71MiB |
|    0   N/A  N/A     84089    C+G   ...AAAAAAAAA= --shared-files      461MiB |
|    0   N/A  N/A     87428      G   ...AAAAAAAAA= --shared-files      247MiB |
|    0   N/A  N/A    363160      G   ...o/bin/firefox/firefox-bin        1MiB |
|    0   N/A  N/A    428987      G   ...o/bin/firefox/firefox-bin       65MiB |
+-----------------------------------------------------------------------------+
````


もう既に2988MiBも使っている。 そりゃあメモリ2GBのQuadroじゃ重くなるわ…  

（同じ構成でWindowsなら問題なく動くと思われる）  


Linuxデスクトップは快適に動くけれども、富豪的なところがあるのでパワーある構成にする必要があるという学びを得た。  

